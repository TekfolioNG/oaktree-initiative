import{_ as e}from"./nuxt-link-X1VbUMwQ.mjs";import{_ as a,u as t,v as n,f as r,a as s,b as o,c as u,d as i}from"./server.mjs";import{A as l}from"../_/nitro.mjs";import{l as c}from"../_/shared.esm-bundler.mjs";import{l as d,x as f,j as v}from"../routes/renderer.mjs";const p={trailing:!0};function debounce(e,a=25,t={}){if(t={...p,...t},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let n,r,s,o,u=[];const applyFn=(a,n)=>(s=async function(e,a,t){return await e.apply(a,t)}(e,a,n),s.finally((()=>{if(s=null,t.trailing&&o&&!r){const e=applyFn(a,o);return o=null,e}})),s);return function(...e){return s?(t.trailing&&(o=e),s):new Promise((s=>{const o=!r&&t.leading;clearTimeout(r),r=setTimeout((()=>{r=null;const a=t.leading?n:applyFn(this,e);for(const e of u)e(a);u=[]}),a),o?(n=applyFn(this,e),s(n)):u.push(s)}))}}function useAsyncData(...e){var a;const t="string"==typeof e[e.length-1]?e.pop():void 0;(function(e,a){if("string"==typeof e)return!1;if("object"==typeof e&&null!==e)return!1;if("function"==typeof e&&"function"==typeof a)return!1;return!0})(e[0],e[1])&&e.unshift(t);let[r,u,l={}]=e;const c=n.computed((()=>n.toValue(r)));if("string"!=typeof c.value)throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if("function"!=typeof u)throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const d=s();null!=l.server||(l.server=!0),null!=l.default||(l.default=getDefault),null!=l.getCachedData||(l.getCachedData=getDefaultCachedData),null!=l.lazy||(l.lazy=!1),null!=l.immediate||(l.immediate=!0),null!=l.deep||(l.deep=o.deep),null!=l.dedupe||(l.dedupe="cancel"),l._functionName,d._asyncData[c.value];const f={cause:"initial",dedupe:l.dedupe};(null==(a=d._asyncData[c.value])?void 0:a._init)||(f.cachedData=l.getCachedData(c.value,d,{cause:"initial"}),d._asyncData[c.value]=function(e,a,t,r,s){var u;null!=(u=e.payload._errors)[a]||(u[a]=o.errorValue);const l=r.getCachedData!==getDefaultCachedData,c=t,d=r.deep?n.ref:n.shallowRef,f=null!=s,v=e.hook("app:data:refresh",(async e=>{e&&!e.includes(a)||await p.execute({cause:"refresh:hook"})})),p={data:d(f?s:r.default()),pending:n.shallowRef(!f),error:n.toRef(e.payload._errors,a),status:n.shallowRef("idle"),execute:(t={})=>{var s,u,l;if(e._asyncDataPromises[a]){if("defer"===(l=null!=(s=t.dedupe)?s:r.dedupe)||!1===l)return e._asyncDataPromises[a];e._asyncDataPromises[a].cancelled=!0}if("initial"===t.cause||e.isHydrating){const n="cachedData"in t?t.cachedData:r.getCachedData(a,e,{cause:null!=(u=t.cause)?u:"refresh:manual"});if(null!=n)return e.payload.data[a]=p.data.value=n,p.error.value=o.errorValue,p.status.value="success",Promise.resolve(n)}p.pending.value=!0,p.status.value="pending";const d=new Promise(((a,t)=>{try{a(c(e))}catch(e){t(e)}})).then((async t=>{if(d.cancelled)return e._asyncDataPromises[a];let n=t;r.transform&&(n=await r.transform(t)),r.pick&&(n=function(e,a){const t={};for(const n of a)t[n]=e[n];return t}(n,r.pick)),e.payload.data[a]=n,p.data.value=n,p.error.value=o.errorValue,p.status.value="success"})).catch((t=>{if(d.cancelled)return e._asyncDataPromises[a];p.error.value=i(t),p.data.value=n.unref(r.default()),p.status.value="error"})).finally((()=>{d.cancelled||(p.pending.value=!1,delete e._asyncDataPromises[a])}));return e._asyncDataPromises[a]=d,e._asyncDataPromises[a]},_execute:debounce(((...e)=>p.execute(...e)),0,{leading:!0}),_default:r.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{v(),p._init=!1,l||n.nextTick((()=>{p._init||(clearNuxtDataByKey(e,a),p.execute=()=>Promise.resolve(),p.data.value=o.value)}))}};return p}(d,c.value,u,l,f.cachedData));d._asyncData[c.value]._deps++;if(!1!==l.server&&d.payload.serverRendered&&l.immediate){const e=d._asyncData[c.value].execute(f);n.getCurrentInstance()?n.onServerPrefetch((()=>e)):d.hook("app:created",(async()=>{await e}))}const v={data:writableComputedRef((()=>{var e;return null==(e=d._asyncData[c.value])?void 0:e.data})),pending:writableComputedRef((()=>{var e;return null==(e=d._asyncData[c.value])?void 0:e.pending})),status:writableComputedRef((()=>{var e;return null==(e=d._asyncData[c.value])?void 0:e.status})),error:writableComputedRef((()=>{var e;return null==(e=d._asyncData[c.value])?void 0:e.error})),refresh:(...e)=>d._asyncData[c.value].execute(...e),execute:(...e)=>d._asyncData[c.value].execute(...e),clear:()=>clearNuxtDataByKey(d,c.value)},p=Promise.resolve(d._asyncDataPromises[c.value]).then((()=>v));return Object.assign(p,v),p}function writableComputedRef(e){return n.computed({get(){var a;return null==(a=e())?void 0:a.value},set(a){const t=e();t&&(t.value=a)}})}function clearNuxtDataByKey(e,a){a in e.payload.data&&(e.payload.data[a]=void 0),a in e.payload._errors&&(e.payload._errors[a]=o.errorValue),e._asyncData[a]&&(e._asyncData[a].data.value=void 0,e._asyncData[a].error.value=o.errorValue,e._asyncData[a].pending.value=!1,e._asyncData[a].status.value="idle"),a in e._asyncDataPromises&&(e._asyncDataPromises[a]&&(e._asyncDataPromises[a].cancelled=!0),e._asyncDataPromises[a]=void 0)}const getDefault=()=>o.value,getDefaultCachedData=(e,a,t)=>a.isHydrating?a.payload.data[e]:"refresh:manual"!==t.cause&&"refresh:hook"!==t.cause?a.static.data[e]:void 0;function generateOptionSegments(e){var a;const t=[(null==(a=n.toValue(e.method))?void 0:a.toUpperCase())||"GET",n.toValue(e.baseURL)];for(const a of[e.params||e.query]){const e=n.toValue(a);if(!e)continue;const r={};for(const[a,t]of Object.entries(e))r[n.toValue(a)]=n.toValue(t);t.push(r)}if(e.body){const a=n.toValue(e.body);if(a)if(a instanceof ArrayBuffer)t.push(l(Object.fromEntries([...new Uint8Array(a).entries()].map((([e,a])=>[e,a.toString()])))));else if(a instanceof FormData){const e={};for(const t of a.entries()){const[a,n]=t;e[a]=n instanceof File?n.name:n}t.push(l(e))}else if(c(a))t.push(l(n.reactive(a)));else try{t.push(l(a))}catch{console.warn("[useFetch] Failed to hash body",a)}else t.push(l(a))}return t}const y={__name:"success",__ssrInlineRender:!0,async setup(a){var s;let o,i;const c=t(),{data:p,pending:y,error:m}=([o,i]=n.withAsyncContext((()=>function(e,a,t){const[s={},o]="string"==typeof a?[{},a]:[a,t],i=n.computed((()=>n.toValue(e))),c=n.computed((()=>n.toValue(s.key)||"$f"+l([o,"string"==typeof i.value?i.value:"",...generateOptionSegments(s)])));if(!s.baseURL&&"string"==typeof i.value&&"/"===i.value[0]&&"/"===i.value[1])throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:d,lazy:f,default:v,transform:p,pick:y,watch:m,immediate:h,getCachedData:g,deep:_,dedupe:D,...w}=s,b=n.reactive({...r,...w,cache:"boolean"==typeof s.cache?void 0:s.cache}),x={server:d,lazy:f,default:v,transform:p,pick:y,immediate:h,getCachedData:g,deep:_,dedupe:D,watch:!1===m?[]:[...m||[],b]};if(!h){let setImmediate=function(){x.immediate=!0};n.watch(c,setImmediate,{flush:"sync",once:!0}),n.watch([...m||[],b],setImmediate,{flush:"sync",once:!0})}let P;return useAsyncData(!1===m?c.value:c,(()=>{var e;null==(e=null==P?void 0:P.abort)||e.call(P,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),P="undefined"!=typeof AbortController?new AbortController:{};const a=n.toValue(s.timeout);let t;a&&(t=setTimeout((()=>P.abort(new DOMException("Request aborted due to timeout.","AbortError"))),a),P.signal.onabort=()=>clearTimeout(t));let r=s.$fetch||globalThis.$fetch;return s.$fetch||"string"==typeof i.value&&"/"===i.value[0]&&(!n.toValue(s.baseURL)||"/"===n.toValue(s.baseURL)[0])&&(r=u()),r(i.value,{signal:P.signal,...b}).finally((()=>{clearTimeout(t)}))}),x)}("/api/donations/verify",{method:"POST",body:{reference:c.query.reference},immediate:!!c.query.reference},"$KCsNvMc7aX"))),o=await o,i(),o);return(null==(s=p.value)?void 0:s.status)&&useTrackDonation(p.value.data),(a,t,r,s)=>{var o;const u=e;t(`<div${d(n.mergeProps({class:"container"},s))} data-v-60860935>`),n.unref(y)?t('<div class="loading" data-v-60860935><p data-v-60860935>Verifying your payment...</p></div>'):n.unref(m)?t(`<div class="error" data-v-60860935><h1 data-v-60860935>Payment Verification Failed</h1><p data-v-60860935>Please contact support with reference: ${f(n.unref(c).query.reference)}</p></div>`):(null==(o=n.unref(p))?void 0:o.status)?(t(`<div class="success" data-v-60860935><h1 data-v-60860935>Thank You for Your Donation!</h1><div class="receipt" data-v-60860935><p data-v-60860935><strong data-v-60860935>Amount:</strong> ${f(n.unref(p).data.amount/100)} ${f(n.unref(p).data.currency)}</p><p data-v-60860935><strong data-v-60860935>Reference:</strong> ${f(n.unref(p).data.reference)}</p><p data-v-60860935><strong data-v-60860935>Date:</strong> ${f(new Date(n.unref(p).data.paid_at).toLocaleString())}</p></div>`),t(v(u,{to:"/",class:"button"},{default:n.withCtx(((e,a,t,r)=>{if(!a)return[n.createTextVNode("Return Home")];a("Return Home")})),_:1},r)),t("</div>")):t('<div class="unknown" data-v-60860935><h1 data-v-60860935>Payment Status Unknown</h1><p data-v-60860935>Your payment is being processed. You&#39;ll receive an email confirmation shortly.</p></div>'),t("</div>")}}},m=y.setup;y.setup=(e,a)=>{const t=n.useSSRContext();return(t.modules||(t.modules=new Set)).add("pages/donation/success.vue"),m?m(e,a):void 0};const h=a(y,[["__scopeId","data-v-60860935"]]);export{h as default};
//# sourceMappingURL=success-BWVl7v_F.mjs.map
